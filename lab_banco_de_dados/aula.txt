17/08/23
CREATE USER "US_768343"
IDENTIFIED BY "F0X"
DEFAULT TABLESPACE "TBLS5W_768343"
TEMPORARY TABLESPACE "TEMP"
PROFILE DEFAULT
ACCOUNT UNLOCK;

laboratorio@grad
unaerp

GRANT CREATE SESSION, CREATE TABLE, SELECT ANY TABLE, INSERT ANY TABLE TO TEST_F;
24/08/2023

excluir usuario
DROP USER TESTECODIGO;

roles
CREATE ROLE PERFILCODIGO;
GRANT PERFILCODIGO TO USER
GRANT TEST_F TO US_768343;

create table "TABLE_F"
(
ID_ALUNO NUMBER(6),
NOM_ALUNO VARCHAR2(40) NOT NULL,
DTN_ALUNO DATE,
CPF_ALUNO VARCHAR2(11) UNIQUE,
SEX_ALUNO CHAR(1),
CONSTRAINT PK_ALUNO PRIMARY KEY (ID_ALUNO)
);

31/08/23

CREATE TABLE DISCIPLINA
(
COD_DISCIPLINA NUMBER(6),
NOM_DISCIPLINA VARCHAR2(30) NOT NULL,
CH_DISCIPLINA NUMBER(3),
CONSTRAINT PK_DISCIPLINA PRIMARY KEY (COD_DISCIPLINA)
);

CREATE TABLE ALUNO_DISCIPLINA
COD_DISCIPLINA NUMBER(6),
ID_ALUNO NUMBER(6),
SEM_ANO_ALU_DISC NUMBER(5),
CONSTRAINT PK ALUNO DISCIPLINA PRIMARY KEY (COD DISCIPLINA, ID_ ALUNO, SEM_ANO_ALU_DISC),
CONSTRAINT FK ALUNO_DISC_ALUNO FOREIGN KEY (ID_ALUNO) REFERENCES ALUNO,
CONSTRAINT FK ALUNO_DISC_DISC FOREIGN KEY (COD_DISCIPLINA) REFERENCES DISCIPLINA
):


exercicio

1 elaborar os scripts p/ criar as tabelas

|Condominio                          |        |UNIDADE                             |
|CNPJ_CONDOMINIO NUMBER(11) (PK)     |-------E|CNPJ_CONDOMINIO NUMBER(11) (PK) (FK)|
|NOM_CONDOMINIO VARCHAR2(40) NOT NULL|        |NUM_UNIDADE NUMBER(3) (PK)          |
|END_CONDOMINIO VARCHAR2(40)         |        |PROP_UNIDADE VARCHAR2(40) NOT NULL  |
|BAI_CONDOMINIO VARCHAR2(35)         |        |CPF_PROP_UNIDADE NUMBER(11)         |
|UF_CONDOMINIO CHAR(2)               |        |                                    |
|CEP_CONDOMINIO NUMBER(8)            |        |                                    |
                                               |              |
                           ____________________|              |
                          |                                   |
                          M                                   M
|TAXA                                |        |CONTATO_UNIDADE                     |
|NUM_TAXA NUMBER(4) (PK)             |        |DDD_CONTATO_UNIDADE NUMBER(2) (PK)  |
|DTV_TAXA DATE                       |        |NUM_CONTATO_UNIDADE NUMBER(10) (PK) |
|VLR_TAXA NUMBER(8,2)                |        |CNPJ_CONDOMINIO NUMBER(11) (PK) (FK)|
|CNPJ_CONDOMINIO NUMBER(11) (FK)     |        |NUM_UNIDADE NUMBER(3) (PK) (FK)     |
|NUM_UNIDADE NUMBER(3) (FK)          |        |                                    |

CREATE TABLE CONDOMINIO
(
CNPJ_CONDOMINIO NUMBER(14),
NOM_CONDOMINIO VARCHAR2(40) NOT NULL,
END_CONDOMINIO VARCHAR2(40),
BAI_CONDOMINIO VARCHAR2(35),
UF_CONDOMINIO CHAR(2),
CEP_CONDOMINIO NUMBER(8),
CONSTRAINT PK_CONDOMINIO PRIMARY KEY (CNPJ_CONDOMINIO)
);

CREATE TABLE UNIDADE
(
NUM_UNIDADE NUMBER(3),
PROP_UNIDADE VARCHAR2(40) NOT NULL,
CPF_PROP_UNIDADE NUMBER(11),
CONSTRAINT PK_UNIDADE PRIMARY KEY (CNPJ_CONDOMINIO, NUM_UNIDADE),
CONSTRAINT FK_CNPJ_CONDOMINIO FOREIGN KEY (CNPJ_CONDOMINIO) REFERENCES CONDOMINIO,
);

CREATE TABLE TAXA
(
NUM_TAXA NUMBER(4),
DTV_TAXA DATE,
VLR_TAXA NUMBER(8,2),
CONSTRAINT PK_TAXA PRIMARY KEY (NUM_TAXA),
CONSTRAINT FK_CNPJ_CONDOMINIO FOREIGN KEY (CNPJ_CONDOMINIO) REFERENCES CONDOMINIO,
CONSTRAINT FK_NUM_UNIDADE FOREIGN KEY (NUM_UNIDADE) REFERENCES UNIDADE,
);

CREATE TABLE CONTATO_UNIDADE
(
DDD_CONTATO_UNIDADE NUMBER(2),
NUM_CONTATO_UNIDADE NUMBER(10),
CONSTRAINT PK_TAXA PRIMARY KEY (DDD_CONTATO_UNIDADE, NUM_CONTATO_UNIDADE, CNPJ_CONDOMINIO, NUM_UNIDADE),
CONSTRAINT FK_CNPJ_CONDOMINIO FOREIGN KEY (CNPJ_CONDOMINIO) REFERENCES CONDOMINIO,
CONSTRAINT FK_NUM_UNIDADE FOREIGN KEY (NUM_UNIDADE) REFERENCES UNIDADE,
);


14/09/2023

alter table 
ALTER TABLE "table name"
operação: ADD | MODIFY | DROP

ex:
1 add 2 novos atributos na tabela ALUNO: RG_ALUNO, EML_ALUNO

ALTER TABLE "ALUNO"
ADD (RG_ALUNO VARCHAR2(11), EML_ALUNO VARCHAR2(4);

2 ajustar tamanho EML_ALUNO (VARCHAR2(40))
ALTER TABLE "ALUNO"
MODIFY EML_ALUNO VARCHAR2(40);

3 add a constrain a tabela curso - pk COD_CURSO
CREATE TABLE CURSO
(COD_CURSO NUMBER (3),
NOM_CURSO VARCHAR2(30),
TMP_CURSO NUMBER(1)
);

ALTER TABLE CURSO
ADD CONSTRAIN PK_CURSO PRIMARY KEY (COD_CURSO);

4- modificar atributo NOM_CURSO para que ele seja obrigatório

ALTER TABLE "ALUNO"
MODIFY NUM_CURSO VERCHAR2(30) NOT NULL;

5- excluir o atributo TMP_CURSO da tabela CURSO
ALTER TABLE "ALUNO"
DROP COLUMN TMP_CURSO;

6- add data de inicio (DTI_CURSO DATE)
ALTER TABLE "ALUNO"
ADD DTI_CURSO DATE;

7- excluir a pk de CURSO
ALTER TABLE "ALUNO"
DROP CONTRAINT PK_CURSO;

8 - add o cod do curso na tab aluno e  implementar integridade referencial
ente as tabs (ALUNO e CURSO)

ALTER TABLE "ALUNO"
ADD COD_CURSO NUMBER(3);

ALTER TABLE "ALUNO"
ADD CONTRAINT FK_ALUNO_CURSO FOREIGN KEY (COD_CURSO) REFERENCES CURSO (COD_CURSO);

DROP TABLE exclui a tab se ela não estiver referenciada

ex

1 excluir tab CURSO
DROP TABLE CURSO;
(*) tab ref com a tab ALUNO

ALTER TABLE "ALUNO"
DROP CONSTRAINT FK_ALUNO_CURSO;

DROP TABLE CURSO;

2 - excluir tab TESTE
DROP TABLE TESTE;

criar tabela apartir de uma existente

CREATE TABLE nome
AS SELECT atributo(s) FROM tabela;
ex:

CREATE TABLE "ALUNO_FRAG"
AS SELECT ID_ALUNO, NOM_ALUNO, DTN_ALUNO
FROM ALUNO;

CREATE TABLE "ALUNO_FRAG"
AS SELECT * FROM ALUNO;

ALTER TABLE "ALUNO_FRAG"
ADD CONSTRAINT PK_ALUNO_FRAG PRIMARY KEY (ID_ALUNO);

21/09/2023

AUTO INCREMENTO NO ORACLE (SEQUENCE)
criar sequencia
  create sequence (auto incremento)
CREATE SEQUENCE "name"
START WITH n 
INCREMENT BY  m
MAX VALUE x
MINVALUE y

exemplo CREATE SEQUENCE "SEQ_ALUNO"
START WITH 1 INCREMENT BY 1;

atribuir papel DBA
GRANT DBA TO "US_768343";

DESC USER_SEQUENCES;
SELECT SEQUENCE-NAME FROM USER-SEQUENCES;

manipular sequencia
CURRVAL - retornar o valor atual da sequencia
NEXTVAL -  proximo valor

ALTER SEQUENCE "nome"
parametros

NOTA:  esses são comandos DDL

agora DML
INSERT , UPDATE , DELETE

INSERT INTO "tabela" [att]
VALUES (val(s));

alfanumerico entre aspas simples ''
data passa valor seguido do formato (ex :'01/01/2023', 'dd/mm/yyyy')

28/09/2023

commit - gravar as tranformações
rollback - undo what havent been commited

update - alterar registros

% - wild

UPDATE ALUNO SET DTN-ALUNO = TO_DATE('15/01/2023', 'DD/MM/AAAA')
WHERE NOM_ALUNO = "João Carlos';

função de string

UPPER() maiuscula
LOWER() minuscula
INITCAP() first letter

26/10/2023
1
AVG() retorna media
SELECT AVG(SAL_MEDICO) SALARIO_MEDIO FROM MEDICO;

2
mostra medicos com salario acima da media
SELECT NOM_MEDICO NOME FROM MEDICO
WHERE SAL_MEDICO >
(SELECT AVG(SAL_MEDICO) SALARIO_MEDIO FROM MEDICO);

3
SUM() retorna soma
SELECT SUM(SAL_MEDICO) TOTAL FROM MEDICO;

4
COUNT() - retorna as linhas encontradas
SELECT COUNT(COD_PACIENTE) QTD FROM PACIENTE WHERE
UPPER(UF_PACIENTE) = 'SP';

5 - mostrar pacientes por estado
SELECT UF_PACIENTE ESTADO, COUNT(COD_PACIENTE) QTD
FROM PACIENTE GROUP BY UF_PACIENTE;

6 - mostrar a quantidade de pacientes por sexo
SELECT SEX_PACIENTE SEXO, COUNT(COD_PACIENTE) QTD
FROM PACIENTE GROUP BY SEX_PACIENTE;

7 - mostrar exames realizados por tipo
SELECT E.NOM_EXAME EXAME, COUNT(EL.COD_EXAME) QTD
FROM EXAME E, EXAME_LABORATORIO EL
WHERE E.COD_EXAME = EL.COD_EXAME
GROUP BY E.NOM_EXAME;

8
SELECT NOM_MEDICO FROM MEDICO WHERE
SAL_MEDICO = (SELECT MAX(SAL_MEDICO) FROM MEDICO);

9
SELECT MIN(NOM_EXAME) EXAME FROM EXAME;


TO_DATE() CONVERT PARA DATE



10
SELECT NOM_PACIENTE NOME FROM PACIENTE
WHERE TO_CHAR(SYSDATE, 'MM') = TO_CHAR(DTN_PACIENTE, 'MM');



9




16/11/2023

CREATE [OR REPLACE] TRIGGER "nome do gatilho"
BEFORE | AFTER INSERT OR UPDATE OR DELETE "nome da tabela"
FOR EACH ROW | STATEMENT

BEGIN

END;

Identificar evento
INSERTING
UPDATING
DELETING

pseudo registros
:new
:old

exemplo
1- criar um gatilho para registrar fragmentos da tabela ALUNO
em outra tabela
Tabale ALUNOFRAG (ID_ALUNO, NOM_ALUNO, DTN_ALUNO, SEX_ALUNO)
-- criar a tabela ALUNOFRAG
CREATE TABLE ALUNOFRAG AS SELECT ID_ALUNO, NOM_ALUNO, DTN_ALUNO, SEX_ALUNO FROM ALUNO;

CREATE OR REPLACE TRIGGER BKP_FRAG_ALUNO
AFTER INSERT OR UPDATE OR DELETE ON ALUNO
FOR EACH ROW
BEGIN
IF INSERTING THEN
INSERT INTO ALUNOFRAG(ID_ALUNO, NOM_ALUNO, DTN_ALUNO, SEX_ALUNO)
VALUES (:NEW.ID_ALUNO, :NEW.NOM_ALUNO, :NEW.DTN_ALUNO, :NEW.SEX_ALUNO);
ELSEIF UPDATING THEN
UPDATE ALUNOFRAG SET ID_ALUNO := NEW.ID_ALUNO, NOM_ALUNO := NEW.NOM_ALUNO, DTN_ALUNO := NEW.DTN_ALUNO, SEX_ALUNO := NEW.SEX_ALUNO WHERE ID_ALUNO := OLD.ID_ALUNO;
ELSE
DELETE ALUNOFRAG WHERE ID_ALUNO := OLD.ID_ALUNO;
END IF;
END;

23/11/23

CREATE [OR REPLACE] FUNCTION nome (parametro - nome tipo)
RETURN tipo_dado_retorno
[IA | AS]
-- vars
nome_var tipo_var
BEGIN
-- command
END;

idade

CREATE OR REPLACE FUNCTIONS IDADE (PDATA IN DATE)
RETURN NUMBER
IS
VIDADE NUMBER(3);
BEGIN
VIDADE := (MONTHS_BTWEEN(SYSDATE, PDATA)/12);
RETURN VIDADE;
END;


SHOW ERRORS;
